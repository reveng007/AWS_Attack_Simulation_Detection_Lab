# It is from BOSS of SOC v3.

## Scenario:
Someone has accidentally made an S3 bucket publicly accessible.

## Hunt Query:
```
index=botsv3 sourcetype=aws:cloudtrail
| where eventName IN ("PutBucketAcl", "PutBucketPolicy")
```

### Output:

2 Events popped Out.

Time: `8/20/18 1:01:46.000 PM` - 1st Event
```
{ [-]
   awsRegion: us-west-1
   eventID: ab45689d-69cd-41e7-8705-5350402cf7ac
   eventName: PutBucketAcl
   eventSource: s3.amazonaws.com
   eventTime: 2018-08-20T13:01:46Z
   eventType: AwsApiCall
   eventVersion: 1.05
   recipientAccountId: 622676721278
   requestID: 487488D003569438
   requestParameters: { [-]
     AccessControlPolicy: { [-]
       AccessControlList: { [-]
         Grant: [ [-]
           { [-]
             Grantee: { [-]
               DisplayName: bstoll
               ID: 4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: CanonicalUser
             }
             Permission: FULL_CONTROL
           }
           { [-]
             Grantee: { [-]
               URI: http://acs.amazonaws.com/groups/s3/LogDelivery
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: Group
             }
             Permission: WRITE
           }
           { [-]
             Grantee: { [-]
               URI: http://acs.amazonaws.com/groups/s3/LogDelivery
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: Group
             }
             Permission: READ_ACP
           }
           { [-]
             Grantee: { [-]
               URI: http://acs.amazonaws.com/groups/s3/LogDelivery
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: Group
             }
             Permission: READ
           }
           { [-]
             Grantee: { [-]
               DisplayName: bstoll
               ID: 4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: CanonicalUser
             }
             Permission: FULL_CONTROL
           }
           { [-]
             Grantee: { [-]
               URI: http://acs.amazonaws.com/groups/global/AllUsers            ------> All users
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: Group
             }
             Permission: READ                                               ----------> Read Access => can be DANGER, but depends!!!!!
           }
           { [-]
             Grantee: { [-]
               URI: http://acs.amazonaws.com/groups/global/AllUsers        ------> All users
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: Group
             }
             Permission: WRITE                                              ----------> Write Access => DANGER
           }
         ]
       }
       Owner: { [-]
         DisplayName: bstoll
         ID: 4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d
       }
       xmlns: http://s3.amazonaws.com/doc/2006-03-01/
     }
     acl: [ [-]
      
     ]
     bucketName: frothlywebcode
   }
   responseElements: null
   sourceIPAddress: 107.77.212.175
   userAgent: signin.amazonaws.com
   userIdentity: { [-]
     accessKeyId: ASIAZB6TMXZ7OA2RDK5X
     accountId: 622676721278
     arn: arn:aws:iam::622676721278:user/bstoll
     invokedBy: signin.amazonaws.com
     principalId: AIDAJUFKXZ44LV4EN4MGK
     sessionContext: { [-]
       attributes: { [-]
         creationDate: 2018-08-20T12:19:44Z
         mfaAuthenticated: false
       }
     }
     type: IAMUser
     userName: bstoll
   }
}
```

In the below mentioned Event, we can see that `AllUsers` URI is completely Removed - updated the S3 ACL after knowing the mistake.

Time: `8/20/18 1:57:54.000 PM` - Latest one
```
{ [-]
   awsRegion: us-west-1
   eventID: 9a33d8df-1e16-4d58-b36d-8e80ce68f8a3
   eventName: PutBucketAcl
   eventSource: s3.amazonaws.com
   eventTime: 2018-08-20T13:57:54Z
   eventType: AwsApiCall
   eventVersion: 1.05
   recipientAccountId: 622676721278
   requestID: 6A18BDBBC85C6E81
   requestParameters: { [-]
     AccessControlPolicy: { [-]
       AccessControlList: { [-]
         Grant: [ [-]
           { [-]
             Grantee: { [-]
               DisplayName: bstoll
               ID: 4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: CanonicalUser
             }
             Permission: FULL_CONTROL
           }
           { [-]
             Grantee: { [-]
               URI: http://acs.amazonaws.com/groups/s3/LogDelivery
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: Group
             }
             Permission: WRITE
           }
           { [-]
             Grantee: { [-]
               URI: http://acs.amazonaws.com/groups/s3/LogDelivery
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: Group
             }
             Permission: READ_ACP
           }
           { [-]
             Grantee: { [-]
               URI: http://acs.amazonaws.com/groups/s3/LogDelivery
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: Group
             }
             Permission: READ
           }
           { [-]
             Grantee: { [-]
               DisplayName: bstoll
               ID: 4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d
               xmlns:xsi: http://www.w3.org/2001/XMLSchema-instance
               xsi:type: CanonicalUser
             }
             Permission: FULL_CONTROL
           }
         ]
       }
       Owner: { [-]
         DisplayName: bstoll
         ID: 4c018053e740f45beb45f68c0f5eff6347745488ae540130432c9fc64fae310d
       }
       xmlns: http://s3.amazonaws.com/doc/2006-03-01/
     }
     acl: [ [-]
      
     ]
     bucketName: frothlywebcode
   }
   responseElements: null
   sourceIPAddress: 107.77.212.175
   userAgent: signin.amazonaws.com
   userIdentity: { [-]
     accessKeyId: ASIAZB6TMXZ7FWTIS4NJ
     accountId: 622676721278
     arn: arn:aws:iam::622676721278:user/bstoll
     invokedBy: signin.amazonaws.com
     principalId: AIDAJUFKXZ44LV4EN4MGK
     sessionContext: { [-]
       attributes: { [-]
         creationDate: 2018-08-20T13:57:22Z
         mfaAuthenticated: false
       }
     }
     type: IAMUser
     userName: bstoll
   }
}
```
