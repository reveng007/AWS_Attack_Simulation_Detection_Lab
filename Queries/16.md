# 16.SOCLabs: Data Theft via Shared S3 Buckets

https://www.soc-labs.top/en/detections/96

## Goal: 
Write detection rules to identify suspicious authorization actions targeting S3 bucket policies.

## Detailed Reasoning :

1. `PutBucketPolicy` Api call is being used for S3 Bucket policy modification.
2. Then `GetObject` Api call for data Exfiltration.

## Sigma Query:

```yaml
title: Data Theft via Shared S3 Buckets
status: test
description: Data Theft via Shared S3 Buckets
references:
    - https://docs.aws.amazon.com/AmazonS3/latest/API/API_PutBucketPolicy.html
author: Soumyanil Biswas
date: 2025-10-18
modified: 2025-10-18
tags:
    - attack.xxxx
logsource:
    product: aws
    service: cloudtrail
detection:
    selection1:
        eventSource: s3.amazonaws.com
        eventType: AwsApiCall
        
        # S3 Bucket policy modified
        eventName: PutBucketPolicy

        # Exfiltration
        #eventName: GetObject
    
    selection2:
        # As it was an attack, external access should be in Allow, and it was Allow, as what we can see in the logs.
        requestParameters.bucketPolicy.Statement|contains:
            Effect: Allow

    condition: selection1 #and selection2
falsepositives:
    - unknown
level: high
fields:
    - eventName
    - sourceIPAddress
    - eventID
    - eventSource
    - userIdentity.arn
    - userIdentity.arn
```

## Query Result:

<img width="1804" height="253" alt="image" src="https://github.com/user-attachments/assets/d8564521-e327-42da-af9d-2af9fe276a1a" />
